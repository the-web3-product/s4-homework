# BTC PoW 共识

##	问题类比：大家在抢写“账本的下一页”。谁先解出谜题，谁就赢得“落款权”和奖励。

## 流程（7 步）
1.	新交易进“等待区”（内存池）。
2.	矿工挑交易打包成候选区块，填上上个区块哈希和随机数 nonce。
3.	不停算哈希，直到哈希值“小于目标难度”（像买彩票，算一次=买一张票）。
4.	谁先中，谁广播“中奖区块”。
5.	全网节点快速验证：签名、余额、规则都对，就接到链尾。
6.	有时两个区块几乎同时传播，会短暂分叉。
7.	大家默认“最长/最重的那条链”为准；等后面再接几块，分叉自然被抛弃（孤块）。

## 常见问题
•	双花：同一笔钱试图花两次。

•	短暂分叉/孤块：网络延迟导致两条链头并存。

•	51% 攻击：多数算力可重组近几块历史。

•	手续费拥堵：高峰时打包慢、费率飙。

•	时间戳作恶/出块抖动：影响难度与出块节奏。

•	网络传播慢：新区块/交易扩散不及时。

•	可扩展性：区块有限、全网都要验证。

## 比特币的应对
•	最长链/概率最终性：默认最长链有效；重要支付等“6 次确认”再算稳。

•	难度调整：每 2016 块（约两周）自动调节难度，目标平均 10 分钟/块。

•	经济激励：区块奖励+手续费；奖励每 21 万块减半，鼓励 honest mining。

•	合理合规的区块与脚本限制：限制脚本复杂度/签名数、标准中继策略，防 DoS。

•	传播优化：先传区块头、Compact Blocks（BIP152）、FIBRE 等加速扩散，降分叉率。

•	费用市场与提速工具：按内存池出价；RBF（BIP125）/CPFP 支持“提费加速确认”。

•	时间保护：使用“中位时间过去”（MTP）限制滥用时间戳，难度调节有上下限。

•	可扩展改进：SegWit 修复交易可塑性、提升有效容量；闪电网络把小额高频移到链下。

•	客户端轻量化：SPV 轻节点只验区块头+默克尔证明，提升可用性。

•	矿池去中心化努力：Stratum v2 支持矿工选交易，降低审查/集中化风险（仍在推进）。

## 高频数字
•	出块目标：约 10 分钟/块

•	难度调整：每 2016 块

•	常用确认数：6（视场景可多可少）

•	奖励减半：每 210,000 块

## 小结
•	PoW 就是“全网拼算力抽签写下一页账本”；用最长链规则、难度调节和经济激励，配合网络与协议优化，把“偶发分叉和作恶动机”压到足够小的概率上。

